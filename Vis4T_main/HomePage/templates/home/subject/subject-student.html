<div class="row">
    <div class="col-12">
        <div class="wrap-box">
            <div class="barChartSubjectStudent"></div>
        </div>
    </div>
</div>
<script>
    function renderBarChartSubjectStudent(data){
        var { subject_name, data } = data;
        excellent = {};
        good = {};
        average = {};
        for(var i = 0; i < data.length; i++){
            if(data[i].rank == 'Giỏi') {
                excellent[data[i].student_id] = data[i].score_10;
            }
            else if(data[i].rank == 'Khá'){
                good[data[i].student_id] = data[i].score_10;
            }
            else{
                average[data[i].student_id] = data[i].score_10;
            }
        }
        console.log(excellent);
        var options = {
            series: [
                {
                    data: Object.values(excellent),
                    type: "column",
                    name: "Học lực giỏi",
                },
                {
                    data: Object.values(good),
                    type: "column",
                    name: "Học lực khá",
                },
                {
                    data: Object.values(average),
                    type: "column",
                    name: "Học lực trung bình và yếu",
                },
            ],
            chart: [{
              height: 350,
              type: "line",
              toolbar: {
                  show: !0
              },
              height: 350,
              type: "line",
              toolbar: {
                  show: !0
              },
              height: 350,
              type: "line",
              toolbar: {
                  show: !0
              }
            }],
            stroke: {
                width: [0, 3],
                curve: "smooth"
            },
            title:{
              text: "THỐNG KÊ ĐIỂM TỔNG KẾT",
              align: 'center',
              style: {
                fontSize:  '25px',
                fontFamily: 'fangsong',
              }
            },
            xaxis: {
              categories: name,
              title: {
                floating: true,
                style: {
                  fontSize:  '20px',
                  fontFamily: 'Roboto'
                },
              },
                
            },
            yAxis: {
              min: 0,
              max: 10,
              labels: {
                overflow: 'justify'
              }
            },
            plotOptions: {
              bar: {
                  horizontal: !1,
                  columnWidth: "70%",
                  borderRadius: 3
              }
            },
            
            legend: {
                show: true
            },
            noData: {
              text: 'Loading...'
            },
            colors: ["#6d77b9", "#5bceac"],
            labels: Object.keys(data),
          };
        const chart = new ApexCharts(document.querySelector(".barChartSubjectStudent"), options);
        chart.render();

    }
    $.ajax({
        url: "{% url 'subject_api' %}" + "?class={{ cached_class_name }}" + "&subject={{ first_subject.subject_id }}",
        type: "GET",
        dataType: "json",
        success: function (data) {
            renderBarChartSubjectStudent(data)
        },
        error: function (data) {
            console.log(data);
        }
    })
    
</script>